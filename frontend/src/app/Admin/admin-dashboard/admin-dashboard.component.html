<div class="d-flex" id="wrapper">

  <!-- Left Sidebar for Running Games -->
  <div class="border-right" id="left-sidebar-wrapper">
    <app-current-games (onGameSelected)="selectGame($event)"></app-current-games>
  </div>
  <!-- /#left-sidebar-wrapper -->

  <!-- Page Content -->
  <div id="page-content-wrapper">
    <nav class="navbar navbar-expand-lg border-bottom">
      <button class="btn btn-primary" id="menu-toggle-left" (click)="toggleLeftSidebar()">Current Games</button>

      <div class="ms-auto">
        <button class="btn p-0" (click)="logout()">
          <i class="fas fa-door-open"></i> <span>Sign Out</span>
        </button>
      </div>
      <form class="d-flex ms-auto">
        <div class="position-relative">
          <input
            class="form-control me-2"
            type="search"
            placeholder="Search"
            [(ngModel)]="searchText"
            name="searchText"
            aria-label="Search"
            (keydown.enter)="onSearch()"
            (input)="updateHints()"
            autocomplete="off"
          >
          <!-- TODO: Select with arrow keys -->
          @if (usernameHints) {
            <ul class="list-group position-absolute search-results" id="searchResults">
              @for (result of usernameHints; track result) {
                <li (click)="selectUser(result)">
                  {{ result }}
                </li>
              }
            </ul>
          }
        </div>
        <button id="search" class="btn btn-outline-success" (click)="onSearch()">
          <span><i class="fa-sharp fa-solid fa-magnifying-glass"></i></span>
        </button>
      </form>
      <button class="btn btn-primary" id="menu-toggle-right" (click)="toggleRightSidebar()">Waiting Players</button>
    </nav>

    <div class="container-fluid">
      <h1 class="mt-4 ms-4">{{userToInspect}}</h1>
      <div class="justify-content-start align-items-start">
        @if (this.adminService.userGames.length > 0) {
          @for (game of this.adminService.userGames; track game) {
            <div class="card">
              <div class="card-body d-flex flex-column align-items-center justify-content-center">
                <!-- Tic-Tac-Toe Board -->
                <app-ttt-board [board]="game.board"></app-ttt-board>

                <!-- Game Info -->
                <div class="game-info d-flex justify-content-between mt-3">
                  <!-- Player 1 Info -->
                  <div class="text-start me-3">
                    @if(game.playerIdentity === 1) {
                      <i class="icon-x"></i>
                    } @else {
                      <i class="icon-o"></i>
                    }
                    <p class="mb-0"><strong>{{ game.player.username }}</strong></p>
                    <small class="text-muted">(Elo: {{ game.player.elo }})</small>
                  </div>

                  <!-- Player 2 Info -->
                  <div class="text-end ms-3">

                    @if(game.playerIdentity === 2) {
                      <i class="icon-x"></i>
                    } @else {
                      <i class="icon-o"></i>
                    }
                    <p class="mb-0"><strong>{{ game.opponent.username }}</strong></p>
                    <small class="text-muted">(Elo: {{ game.opponent.elo }})</small>
                  </div>
                </div>

                <!-- Winner Information -->
                <!-- todo: Styling -->
                @if (game.outcome === GameResult.Self) {
                  <p class="text-center mt-3"><strong>Winner:</strong> {{ game.player.username }}</p>
                } @else if (game.outcome === GameResult.Opponent) {
                  <p class="text-center mt-3"><strong>Winner:</strong> {{ game.opponent.username }}</p>
                } @else {
                  <p class="text-center mt-3"><strong>Draw!</strong></p>
                }
              </div>
            </div>
          }
        }
      </div>
    </div>
  </div>
  <!-- /#page-content-wrapper -->




  <!-- Right Sidebar for Matchmaking Queue -->
  <div class="border-left" id="right-sidebar-wrapper">
    <app-waiting-players></app-waiting-players>
  </div>
  <!-- /#right-sidebar-wrapper -->

  @if (selectedGame) {
    <div class="game-details-box" [ngClass]="{'show': selectedGame}"
         [ngStyle]="{'top.px': boxPosition.top, 'left.px': boxPosition.left}">
      <div class="game-details-arrow"></div>
      @if (selectedGame.player1) {
        <button class="btn btn-primary" (click)="inspectPlayer(selectedGame.player1)">
          Inspect {{ selectedGame.player1.username }}
        </button>
      }
      @if (selectedGame.player2) {
        <button class="btn btn-primary" (click)="inspectPlayer(selectedGame.player2)">
          Inspect {{ selectedGame.player2.username }}
        </button>
      }
      <button class="btn btn-primary" (click)="spectateGame(selectedGame)">Spectate Game</button>

    </div>
  }
</div>
